<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UserServiceTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">java in sharewrap_backend Coverage Results, java in sharewrap_backend Coverage Results</a> &gt; <a href="index.source.html" class="el_package">com.sharewrap.sharewrap_backend.services</a> &gt; <span class="el_source">UserServiceTest.java</span></div><h1>UserServiceTest.java</h1><pre class="source lang-java linenums">package com.sharewrap.sharewrap_backend.services;

import com.sharewrap.sharewrap_backend.dtos.LoginDto;
import com.sharewrap.sharewrap_backend.dtos.PromptpayDto;
import com.sharewrap.sharewrap_backend.dtos.RegisterDto;
import com.sharewrap.sharewrap_backend.dtos.UserDto;
import com.sharewrap.sharewrap_backend.exceptions.AppException;
import com.sharewrap.sharewrap_backend.exceptions.UserExceptionHandler;
import com.sharewrap.sharewrap_backend.exceptions.UserExceptionHandlerTests;
import com.sharewrap.sharewrap_backend.mappers.PromptpayMapper;
import com.sharewrap.sharewrap_backend.mappers.UserMapper;
import com.sharewrap.sharewrap_backend.models.Bill;
import com.sharewrap.sharewrap_backend.models.Promptpay;
import com.sharewrap.sharewrap_backend.models.User;
import com.sharewrap.sharewrap_backend.repositories.BillRepository;
import com.sharewrap.sharewrap_backend.repositories.PromptpayRepository;
import com.sharewrap.sharewrap_backend.repositories.UserRepository;
import org.junit.jupiter.api.Test;
import org.mockito.Mockito;
import org.springframework.core.MethodParameter;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.MethodArgumentNotValidException;

import java.io.ByteArrayOutputStream;
import java.io.PrintStream;
import java.util.*;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertTrue;
import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

<span class="fc" id="L37">public class UserServiceTest {</span>
    // Test case 1 - login
    // Test case 1 - login interface based (T1)
    @Test
    public void test_valid_login_credentials_print_logging_in() {
<span class="fc" id="L42">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L43">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L44">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L45">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>
<span class="fc" id="L46">        boolean result = false;</span>
<span class="fc" id="L47">        LoginDto loginDto = new LoginDto(&quot;test@example.com&quot;, &quot;password&quot;.toCharArray());</span>
<span class="fc" id="L48">        User user = new User(&quot;test@example.com&quot;, &quot;test&quot;);</span>
<span class="fc" id="L49">        user.setPassword(&quot;password&quot;);</span>

<span class="fc" id="L51">        when(userRepository.findByEmail(loginDto.getEmail())).thenReturn(Optional.of(user));</span>
<span class="fc" id="L52">        when(passwordEncoder.matches(Mockito.any(CharSequence.class), Mockito.anyString())).thenReturn(true);</span>

<span class="fc" id="L54">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>

<span class="fc" id="L56">        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();</span>
<span class="fc" id="L57">        System.setOut(new PrintStream(outputStream));</span>

<span class="fc" id="L59">        userService.login(loginDto);</span>

<span class="pc bpc" id="L61" title="1 of 2 branches missed.">        if(&quot;logging  in...&quot;.equals(outputStream.toString().trim())){</span>
<span class="fc" id="L62">            result = true;</span>
        }
<span class="fc" id="L64">        assertTrue(result);</span>
<span class="fc" id="L65">    }</span>
    // Test case 1 - login interface based (T2)
    @Test
    public void test_valid_login_with_invalid_password() {
<span class="fc" id="L69">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L70">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L71">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L72">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>
<span class="fc" id="L73">        boolean result = true;</span>
<span class="fc" id="L74">        LoginDto loginDto = new LoginDto(&quot;test@example.com&quot;, &quot;wrongpassword&quot;.toCharArray());</span>
<span class="fc" id="L75">        User user = new User(&quot;test@example.com&quot;, &quot;test&quot;);</span>
<span class="fc" id="L76">        user.setPassword(&quot;password&quot;);</span>

<span class="fc" id="L78">        when(userRepository.findByEmail(loginDto.getEmail())).thenReturn(Optional.of(user));</span>
<span class="fc" id="L79">        when(passwordEncoder.matches(Mockito.any(CharSequence.class), Mockito.anyString())).thenReturn(false);</span>

<span class="fc" id="L81">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>

        try {
<span class="nc" id="L84">            userService.login(loginDto);</span>
<span class="nc" id="L85">            fail(&quot;Expected AppException to be thrown&quot;);</span>
<span class="fc" id="L86">        } catch (AppException e) {</span>
<span class="pc bpc" id="L87" title="2 of 4 branches missed.">            if (HttpStatus.BAD_REQUEST == e.getStatus() &amp;&amp; &quot;Invalid password&quot; == e.getMessage()){</span>
<span class="fc" id="L88">                result = false;</span>
            }
<span class="nc" id="L90">        }</span>
<span class="fc" id="L91">        assertFalse(result);</span>
<span class="fc" id="L92">    }</span>
    // Test case 1 - login interface based (T3)
    @Test
    public void test_valid_login_with_invalid_email() {
<span class="fc" id="L96">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L97">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L98">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L99">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>
<span class="fc" id="L100">        boolean result = true;</span>
<span class="fc" id="L101">        LoginDto loginDto = new LoginDto(&quot;&quot;, &quot;password&quot;.toCharArray());</span>

<span class="fc" id="L103">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>

<span class="pc" id="L105">        AppException exception = assertThrows(AppException.class, () -&gt; userService.login(loginDto));</span>
<span class="pc bpc" id="L106" title="1 of 2 branches missed.">        if(HttpStatus.NOT_FOUND == exception.getStatus()) {</span>
<span class="fc" id="L107">            result = false;</span>
        }
<span class="fc" id="L109">        assertFalse(result);</span>
<span class="fc" id="L110">    }</span>
    // Test case 1 - login interface based (T4)
    @Test
    public void test_valid_login_with_invalid_email_invalid_password() {
<span class="fc" id="L114">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L115">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L116">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L117">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>
<span class="fc" id="L118">        boolean result = true;</span>
<span class="fc" id="L119">        LoginDto loginDto = new LoginDto(&quot;&quot;, &quot;wrongpassword&quot;.toCharArray());</span>
<span class="fc" id="L120">        User user = new User(&quot;test@example.com&quot;, &quot;test&quot;);</span>
<span class="fc" id="L121">        user.setPassword(&quot;password&quot;);</span>

<span class="fc" id="L123">        when(userRepository.findByEmail(loginDto.getEmail())).thenReturn(Optional.of(user));</span>
<span class="fc" id="L124">        when(passwordEncoder.matches(Mockito.any(CharSequence.class), Mockito.anyString())).thenReturn(false);</span>

<span class="fc" id="L126">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>

<span class="pc" id="L128">        AppException exception = assertThrows(AppException.class, () -&gt; userService.login(loginDto));</span>
<span class="pc bpc" id="L129" title="1 of 2 branches missed.">        if(HttpStatus.BAD_REQUEST == exception.getStatus()){</span>
<span class="fc" id="L130">            result = false;</span>
        }
<span class="fc" id="L132">        assertFalse(result);</span>
<span class="fc" id="L133">    }</span>
    // Test case 1 - login functionality based
    // Test case 1 - login functionality based (T1)
    @Test
    public void test_valid_login_func() {
<span class="fc" id="L138">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L139">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L140">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L141">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L143">        LoginDto loginDto = new LoginDto(&quot;test@example.com&quot;, &quot;password&quot;.toCharArray());</span>
<span class="fc" id="L144">        User user = new User(&quot;test@example.com&quot;, &quot;test&quot;);</span>
<span class="fc" id="L145">        user.setPassword(&quot;password&quot;);</span>

<span class="fc" id="L147">        when(userRepository.findByEmail(loginDto.getEmail())).thenReturn(Optional.of(user));</span>
<span class="fc" id="L148">        when(passwordEncoder.matches(Mockito.any(CharSequence.class), Mockito.anyString())).thenReturn(true);</span>

<span class="fc" id="L150">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>

<span class="fc" id="L152">        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();</span>
<span class="fc" id="L153">        System.setOut(new PrintStream(outputStream));</span>

<span class="fc" id="L155">        userService.login(loginDto);</span>

<span class="fc" id="L157">        assertEquals(&quot;logging  in...&quot;, outputStream.toString().trim());</span>
<span class="fc" id="L158">    }</span>
    // Test case 1 - login functionality based (T2)
    @Test
    public void test_valid_login_func_with_invalid_password() {
<span class="fc" id="L162">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L163">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L164">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L165">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L167">        LoginDto loginDto = new LoginDto(&quot;test@example.com&quot;, &quot;wrongpassword&quot;.toCharArray());</span>
<span class="fc" id="L168">        User user = new User(&quot;test@example.com&quot;, &quot;test&quot;);</span>
<span class="fc" id="L169">        user.setPassword(&quot;password&quot;);</span>

<span class="fc" id="L171">        when(userRepository.findByEmail(loginDto.getEmail())).thenReturn(Optional.of(user));</span>
<span class="fc" id="L172">        when(passwordEncoder.matches(Mockito.any(CharSequence.class), Mockito.anyString())).thenReturn(false);</span>

<span class="fc" id="L174">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>

        try {
<span class="nc" id="L177">            userService.login(loginDto);</span>
<span class="nc" id="L178">            fail(&quot;Expected AppException to be thrown&quot;);</span>
<span class="fc" id="L179">        } catch (AppException e) {</span>
<span class="fc" id="L180">            assertEquals(HttpStatus.BAD_REQUEST, e.getStatus());</span>
<span class="fc" id="L181">            assertEquals(&quot;Invalid password&quot;, e.getMessage());</span>
<span class="nc" id="L182">        }</span>
<span class="fc" id="L183">    }</span>
    // Test case 1 - login login functionality based (T3)
    @Test
    public void test_valid_login_func_with_invalid_email() {
<span class="fc" id="L187">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L188">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L189">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L190">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L192">        LoginDto loginDto = new LoginDto(&quot;&quot;, &quot;password&quot;.toCharArray());</span>

<span class="fc" id="L194">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>

<span class="pc" id="L196">        AppException exception = assertThrows(AppException.class, () -&gt; userService.login(loginDto));</span>
<span class="fc" id="L197">        assertEquals(HttpStatus.NOT_FOUND, exception.getStatus());</span>
<span class="fc" id="L198">    }</span>
    // Test case 1 - login functionality based (T4)
    @Test
    public void test_valid_login_func_with_invalid_email_invalid_password() {
<span class="fc" id="L202">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L203">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L204">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L205">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>
<span class="fc" id="L206">        boolean result = false;</span>
<span class="fc" id="L207">        LoginDto loginDto = new LoginDto(&quot;&quot;, &quot;wrongpassword&quot;.toCharArray());</span>
<span class="fc" id="L208">        User user = new User(&quot;test@example.com&quot;, &quot;test&quot;);</span>
<span class="fc" id="L209">        user.setPassword(&quot;password&quot;);</span>

<span class="fc" id="L211">        when(userRepository.findByEmail(loginDto.getEmail())).thenReturn(Optional.of(user));</span>
<span class="fc" id="L212">        when(passwordEncoder.matches(Mockito.any(CharSequence.class), Mockito.anyString())).thenReturn(false);</span>

<span class="fc" id="L214">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>

<span class="pc" id="L216">        AppException exception = assertThrows(AppException.class, () -&gt; userService.login(loginDto));</span>
<span class="fc" id="L217">        assertEquals(HttpStatus.BAD_REQUEST, exception.getStatus());</span>
<span class="fc" id="L218">    }</span>

    // Test case 2 - generateUniqueUserId
    // Test case 2 - generateUniqueUserId interface based (T1)
    @Test
    public void test_generateUniqueUserId_uniqueUsername1() {
<span class="fc" id="L224">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L225">        Mockito.when(userRepository.existsById(Mockito.anyString())).thenReturn(false);</span>
<span class="fc" id="L226">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L227">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L228">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L230">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L231">        String username = &quot;john_doe&quot;;</span>
<span class="fc" id="L232">        String userId = userService.generateUniqueUserId(username);</span>
<span class="pc bpc" id="L233" title="1 of 2 branches missed.">        assertFalse(username.length()+3 == userId.length());</span>
<span class="fc" id="L234">    }</span>
    // Test case 2 - generateUniqueUserId interface based (T2)
    @Test
    public void test_generateUniqueUserId_uniqueUsername2() {
<span class="fc" id="L238">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L239">        Mockito.when(userRepository.existsById(Mockito.anyString())).thenReturn(false);</span>
<span class="fc" id="L240">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L241">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L242">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L244">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L245">        String username = &quot;john_doe&quot;;</span>
<span class="fc" id="L246">        String userId = userService.generateUniqueUserId(username);</span>
<span class="pc bpc" id="L247" title="1 of 2 branches missed.">        assertTrue(username.length()+6 == userId.length());</span>
<span class="fc" id="L248">    }</span>
    // Test case 2 - generateUniqueUserId interface based (T3)
    @Test
    public void test_generateUniqueUserId_uniqueUsername3() {
<span class="fc" id="L252">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L253">        Mockito.when(userRepository.existsById(Mockito.anyString())).thenReturn(false);</span>
<span class="fc" id="L254">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L255">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L256">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L258">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L259">        String username = &quot;john_doe&quot;;</span>
<span class="fc" id="L260">        String userId = userService.generateUniqueUserId(username);</span>
<span class="pc bpc" id="L261" title="1 of 2 branches missed.">        assertFalse(username.length()+8 == userId.length());</span>
<span class="fc" id="L262">    }</span>
    // Test case 2 - generateUniquesUserId functionality based (T1)
    @Test
    public void test_generateUniqueUserId_differentUsernames() {
<span class="fc" id="L266">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L267">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L268">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L269">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L271">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L272">        String username1 = &quot;john_doe&quot;;</span>
<span class="fc" id="L273">        String username2 = &quot;jane_smith&quot;;</span>

<span class="fc" id="L275">        String userId1 = userService.generateUniqueUserId(username1);</span>
<span class="fc" id="L276">        String userId2 = userService.generateUniqueUserId(username2);</span>

<span class="fc" id="L278">        assertNotEquals(userId1, userId2);</span>
<span class="fc" id="L279">    }</span>
    // Test case 2 - generateUniquesUserId functionality based (T2)
    @Test
    public void test_generateUniqueUserId_sameUsernames() {
<span class="fc" id="L283">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L284">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L285">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L286">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L288">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L289">        String username1 = &quot;john_doe&quot;;</span>
<span class="fc" id="L290">        String username2 = &quot;john_doe&quot;;</span>

<span class="fc" id="L292">        String userId1 = userService.generateUniqueUserId(username1);</span>
<span class="fc" id="L293">        String userId2 = userService.generateUniqueUserId(username2);</span>
<span class="fc" id="L294">        assertNotEquals(userId1, userId2);</span>
<span class="fc" id="L295">    }</span>
    // Test case 3 - generateUserId
    // Test case 3 - generateUserId interface based (T1)
    @Test
    public void test_getUser_exist() {
<span class="fc" id="L300">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L301">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L302">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L303">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L305">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L306">        String validUserId = &quot;validUserId&quot;;</span>
<span class="fc" id="L307">        boolean ans = false;</span>
<span class="fc" id="L308">        User user = new User();</span>
<span class="fc" id="L309">        user.setId(validUserId);</span>
<span class="fc" id="L310">        when(userRepository.findById(validUserId)).thenReturn(Optional.of(user));</span>
<span class="fc" id="L311">        when(userMapper.toUserDto(any(User.class)))</span>
<span class="fc" id="L312">                .thenAnswer(invocation -&gt; {</span>
<span class="fc" id="L313">                    User userArgument = invocation.getArgument(0);</span>
<span class="fc" id="L314">                    UserDto userDto = new UserDto();</span>
<span class="fc" id="L315">                    userDto.setId(userArgument.getId());</span>
<span class="fc" id="L316">                    return userDto;</span>
                });
        // Act
<span class="fc" id="L319">        UserDto result = userService.getUser(validUserId);</span>

        // Assert
<span class="fc" id="L322">        assertNotNull(result);</span>
<span class="pc bpc" id="L323" title="1 of 2 branches missed.">        if (validUserId.equals(result.getId())) {</span>
<span class="fc" id="L324">            ans = true;</span>
        }
<span class="fc" id="L326">        assertTrue(ans);</span>
<span class="fc" id="L327">    }</span>
    // Test case 3 - generateUserId interface based (T2)
    @Test
    public void test_getUser_not_found() {
<span class="fc" id="L331">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L332">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L333">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L334">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>
<span class="fc" id="L335">        boolean ans = true;</span>

<span class="fc" id="L337">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L338">        String invalidUserId = &quot;invalidUserId&quot;;</span>
<span class="fc" id="L339">        when(userRepository.findById(invalidUserId)).thenReturn(Optional.empty());</span>

        try {
<span class="nc" id="L342">            userService.getUser(invalidUserId);</span>
<span class="fc" id="L343">        } catch (AppException e) {</span>
<span class="fc" id="L344">            ans = false;</span>
<span class="nc" id="L345">        }</span>
        // Assert
<span class="fc" id="L347">        assertFalse(ans);</span>
<span class="fc" id="L348">    }</span>
    // Test case 3 - generateUserId functionality based (T1)
    @Test
    public void test_valid_userId() {
<span class="fc" id="L352">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L353">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L354">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L355">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L357">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L358">        String validUserId = &quot;validUserId&quot;;</span>

<span class="fc" id="L360">        User user = new User();</span>
<span class="fc" id="L361">        user.setId(validUserId);</span>
<span class="fc" id="L362">        when(userRepository.findById(validUserId)).thenReturn(Optional.of(user));</span>
<span class="fc" id="L363">        when(userMapper.toUserDto(any(User.class)))</span>
<span class="fc" id="L364">                .thenAnswer(invocation -&gt; {</span>
<span class="fc" id="L365">                    User userArgument = invocation.getArgument(0);</span>
<span class="fc" id="L366">                    UserDto userDto = new UserDto();</span>
<span class="fc" id="L367">                    userDto.setId(userArgument.getId());</span>
<span class="fc" id="L368">                    return userDto;</span>
                });
        // Act
<span class="fc" id="L371">        UserDto result = userService.getUser(validUserId);</span>

        // Assert
<span class="fc" id="L374">        assertNotNull(result);</span>
<span class="fc" id="L375">        assertEquals(validUserId, result.getId());</span>
<span class="fc" id="L376">    }</span>
    // Test case 3 - generateUserId functionality based (T2)
    @Test
    public void test_getUser_not_found_func() {
<span class="fc" id="L380">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L381">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L382">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L383">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

        // Arrange
<span class="fc" id="L386">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L387">        String invalidUserId = &quot;invalidUserId&quot;;</span>
<span class="fc" id="L388">        when(userRepository.findById(invalidUserId)).thenReturn(Optional.empty());</span>

        // Act
<span class="pc" id="L391">        assertThrows(AppException.class, () -&gt; userService.getUser(invalidUserId));</span>
<span class="fc" id="L392">    }</span>


    //Other tests
    @Test
    public void test_unknown_email() {
<span class="fc" id="L398">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L399">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L400">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L401">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L403">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L404">        String email = &quot;unknown@example.com&quot;;</span>
<span class="fc" id="L405">        when(userRepository.findByEmail(email)).thenReturn(Optional.empty());</span>

        // Act and Assert
<span class="pc" id="L408">        AppException exception = assertThrows(AppException.class, () -&gt; userService.findByEmail(email));</span>
<span class="fc" id="L409">        assertEquals(HttpStatus.NOT_FOUND, exception.getStatus());</span>
<span class="fc" id="L410">    }</span>
    @Test
    public void test_generateUserId_length() {
<span class="fc" id="L413">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L414">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L415">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L416">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L418">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L419">        String username = &quot;john_doe&quot;;</span>
<span class="fc" id="L420">        String result = userService.generateUserId(username);</span>
<span class="fc" id="L421">        assertEquals(username.length() + 6, result.length());</span>
<span class="fc" id="L422">    }</span>
    @Test
    public void test_generateUserId_length1() {
<span class="fc" id="L425">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L426">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L427">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L428">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L430">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L431">        String username = &quot;&quot;;</span>
<span class="fc" id="L432">        String result = userService.generateUserId(username);</span>
<span class="fc" id="L433">        assertEquals(username.length() + 6, result.length());</span>
<span class="fc" id="L434">    }</span>
    @Test
    public void test_generateUserId_oneCharacter() {
<span class="fc" id="L437">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L438">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L439">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L440">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L442">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L443">        String username = &quot;a&quot;;</span>
<span class="fc" id="L444">        String result = userService.generateUserId(username);</span>
<span class="fc" id="L445">        assertEquals(7, result.length());</span>
<span class="fc" id="L446">    }</span>
    @Test
    public void test_register_null_email() {
        // Arrange
<span class="fc" id="L450">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L451">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L452">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L453">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L455">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>

<span class="fc" id="L457">        RegisterDto userDto = new RegisterDto(null, &quot;testuser&quot;, &quot;password&quot;.toCharArray());</span>

        // Act and Assert
<span class="pc" id="L460">        assertThrows(NullPointerException.class, () -&gt; userService.register(userDto));</span>
<span class="fc" id="L461">        verify(userRepository, never()).findByEmail(anyString());</span>
<span class="fc" id="L462">    }</span>
    @Test
    public void test_register_existing_email() {
        // Arrange
<span class="fc" id="L466">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L467">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L468">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L469">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L471">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L472">        RegisterDto userDto = new RegisterDto(&quot;test@example.com&quot;, &quot;testuser&quot;, &quot;password&quot;.toCharArray());</span>
<span class="fc" id="L473">        User existingUser = new User(&quot;test@example.com&quot;, &quot;existinguser&quot;);</span>

<span class="fc" id="L475">        when(userRepository.findByEmail(userDto.getEmail())).thenReturn(Optional.of(existingUser));</span>

        // Act and Assert
<span class="pc" id="L478">        assertThrows(AppException.class, () -&gt; userService.register(userDto));</span>
<span class="fc" id="L479">        verify(userRepository).findByEmail(userDto.getEmail());</span>
<span class="fc" id="L480">    }</span>
    @Test
    public void test_invalid_user_id() {
        // Arrange
<span class="fc" id="L484">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L485">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L486">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L487">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>

<span class="fc" id="L489">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L490">        String userId = &quot;invalidUserId&quot;;</span>
<span class="fc" id="L491">        Bill bill = new Bill();</span>

        // Act and Assert
        try {
<span class="nc" id="L495">            userService.addBill(userId, bill);</span>
<span class="nc" id="L496">            fail(&quot;Expected AppException, but no exception was thrown&quot;);</span>
<span class="fc" id="L497">        } catch (AppException e) {</span>
<span class="fc" id="L498">            assertEquals(&quot;Unknown user&quot;, e.getMessage());</span>
<span class="nc" id="L499">        }</span>
<span class="fc" id="L500">    }</span>
    @Test
    void test_add_bills_null_user_id() {
        // Arrange
<span class="fc" id="L504">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L505">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L506">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L507">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>
<span class="fc" id="L508">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L509">        String userId = null;</span>
<span class="fc" id="L510">        List&lt;Bill&gt; billList = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L511">        Bill bill1 = new Bill(&quot;Bill 1&quot;);</span>
<span class="fc" id="L512">        Bill bill2 = new Bill(&quot;Bill 2&quot;);</span>
<span class="fc" id="L513">        billList.add(bill1);</span>
<span class="fc" id="L514">        billList.add(bill2);</span>

        // Act and Assert
<span class="pc" id="L517">        AppException exception = assertThrows(AppException.class, () -&gt; userService.addBills(userId, billList));</span>
<span class="fc" id="L518">        assertEquals(&quot;Unknown user&quot;, exception.getMessage());</span>
<span class="fc" id="L519">    }</span>
    @Test
    public void test_add_bills_unknown_user() {
        // Arrange
<span class="fc" id="L523">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L524">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L525">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L526">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>
<span class="fc" id="L527">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>

        // Mock the UserRepository to return an empty optional when findById is called
<span class="fc" id="L530">        when(userRepository.findById(&quot;user123&quot;)).thenReturn(Optional.empty());</span>

<span class="fc" id="L532">        String userId = &quot;user123&quot;;</span>
<span class="fc" id="L533">        List&lt;Bill&gt; billList = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L534">        Bill bill1 = new Bill(&quot;Bill 1&quot;);</span>
<span class="fc" id="L535">        Bill bill2 = new Bill(&quot;Bill 2&quot;);</span>
<span class="fc" id="L536">        billList.add(bill1);</span>
<span class="fc" id="L537">        billList.add(bill2);</span>

        // Act and Assert
<span class="pc" id="L540">        assertThrows(AppException.class, () -&gt; userService.addBills(userId, billList));</span>

        // Verify that findById was called with the correct user ID
<span class="fc" id="L543">        verify(userRepository, times(1)).findById(userId);</span>

        // Verify that no interactions happened with other mocks
<span class="fc" id="L546">        verifyNoMoreInteractions(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L547">    }</span>
    @Test
    public void test_null_user_id() {
        // Arrange
<span class="fc" id="L551">        String userId = null;</span>
<span class="fc" id="L552">        String friendId = &quot;friend1&quot;;</span>

<span class="fc" id="L554">        UserRepository userRepository = mock(UserRepository.class);</span>

        // Assuming you have a user in the repository for the friend
<span class="fc" id="L557">        User friendUser = new User();</span>
<span class="fc" id="L558">        when(userRepository.findById(friendId)).thenReturn(Optional.of(friendUser));</span>

<span class="fc" id="L560">        UserService userService = new UserService(userRepository, null, null, null);</span>

        // Act and Assert
<span class="pc" id="L563">        assertThrows(AppException.class, () -&gt; userService.deleteFriend(userId, friendId));</span>
<span class="fc" id="L564">    }</span>
    @Test
    public void test_valid_username() {
        // Arrange
<span class="fc" id="L568">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L569">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L570">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L571">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>
<span class="fc" id="L572">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L573">        String validUsername = &quot;john_doe&quot;;</span>

        // Mock behavior of userRepository.findByUsername to return an empty Optional
<span class="fc" id="L576">        when(userRepository.findByUsername(validUsername)).thenReturn(Optional.empty());</span>

        // Act and Assert
<span class="pc" id="L579">        AppException exception = assertThrows(AppException.class, () -&gt; userService.findByUsername(validUsername));</span>
<span class="fc" id="L580">        assertEquals(&quot;Unknown user&quot;, exception.getMessage());</span>
<span class="fc" id="L581">    }</span>
    @Test
    public void test_correct_userDto() {
        // Arrange
<span class="fc" id="L585">        UserRepository userRepository = Mockito.mock(UserRepository.class);</span>
<span class="fc" id="L586">        PasswordEncoder passwordEncoder = Mockito.mock(PasswordEncoder.class);</span>
<span class="fc" id="L587">        UserMapper userMapper = Mockito.mock(UserMapper.class);</span>
<span class="fc" id="L588">        BillRepository billRepository = Mockito.mock(BillRepository.class);</span>
<span class="fc" id="L589">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>
<span class="fc" id="L590">        String validUsername = &quot;john_doe&quot;;</span>
<span class="fc" id="L591">        User expectedUser = new User(&quot;john.doe@example.com&quot;, validUsername);</span>
<span class="fc" id="L592">        UserDto expectedUserDto = new UserDto(expectedUser.getId(), expectedUser.getEmail(), expectedUser.getUsername(), &quot;&quot;);</span>
<span class="fc" id="L593">        when(userRepository.findByUsername(validUsername)).thenReturn(Optional.of(expectedUser));</span>

        // Act
<span class="fc" id="L596">        UserDto result = userService.findByUsername(validUsername);</span>

        // Assert
<span class="nc" id="L599">        assertEquals(expectedUserDto, result);</span>
<span class="nc" id="L600">    }</span>
    @Test
    public void test_valid_username_findByUsername() {
        // Arrange
<span class="fc" id="L604">        UserRepository userRepository = mock(UserRepository.class);</span>
<span class="fc" id="L605">        UserMapper userMapper = mock(UserMapper.class);</span>
<span class="fc" id="L606">        PasswordEncoder passwordEncoder = mock(PasswordEncoder.class);</span>
<span class="fc" id="L607">        BillRepository billRepository = mock(BillRepository.class);</span>
<span class="fc" id="L608">        UserService userService = new UserService(userRepository, passwordEncoder, userMapper, billRepository);</span>

<span class="fc" id="L610">        String username = &quot;Unknown user&quot;;</span>
<span class="fc" id="L611">        User user = new User();</span>
<span class="fc" id="L612">        user.setUsername(username);</span>
<span class="fc" id="L613">        UserDto expectedUserDto = new UserDto();</span>

        // Define the behavior of mocks
<span class="fc" id="L616">        when(userRepository.findByUsername(username)).thenReturn(Optional.of(user));</span>
<span class="fc" id="L617">        when(userMapper.toUserDto(user)).thenReturn(expectedUserDto);</span>

        // Act
<span class="fc" id="L620">        UserDto result = userService.findByUsername(username);</span>

        // Assert
<span class="fc" id="L623">        assertNotNull(result);</span>
<span class="fc" id="L624">        assertNotNull(expectedUserDto);</span>
<span class="fc" id="L625">        assertEquals(expectedUserDto, result);</span>

        // Verify that the expected methods were called on mocks
<span class="fc" id="L628">        verify(userRepository).findByUsername(username);</span>
<span class="fc" id="L629">        verify(userMapper).toUserDto(user);</span>
<span class="fc" id="L630">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>